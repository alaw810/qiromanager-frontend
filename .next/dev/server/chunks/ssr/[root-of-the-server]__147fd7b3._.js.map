{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///Users/adrialorente/Downloads/web-v1.3/lib/api/axios-client.ts"],"sourcesContent":["import axios, { type AxiosError, type InternalAxiosRequestConfig } from \"axios\"\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8080\"\n\nexport const axiosClient = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n})\n\n// Request interceptor to attach JWT token\naxiosClient.interceptors.request.use(\n  (config: InternalAxiosRequestConfig) => {\n    if (typeof window !== \"undefined\") {\n      const token = localStorage.getItem(\"token\")\n      if (token && config.headers) {\n        config.headers.Authorization = `Bearer ${token}`\n      }\n    }\n    return config\n  },\n  (error) => Promise.reject(error),\n)\n\n// Response interceptor for error handling\naxiosClient.interceptors.response.use(\n  (response) => response,\n  (error: AxiosError) => {\n    const status = error.response?.status;\n    const url = error.config?.url ?? \"\";\n\n    // Detect if this error came from login/register\n    const isAuthRequest =\n      url.includes(\"/api/v1/auth/login\") ||\n      url.includes(\"/api/v1/auth/register\");\n\n    if (status === 401 && !isAuthRequest) {\n      // Token expired or invalid – ONLY redirect if it's not a login attempt\n      if (typeof window !== \"undefined\") {\n        localStorage.removeItem(\"token\");\n        localStorage.removeItem(\"user\");\n        window.location.href = \"/login\";\n      }\n    } else if (status === 403) {\n      // Access denied – redirect only if not an auth route\n      if (!isAuthRequest && typeof window !== \"undefined\") {\n        window.location.href = \"/access-denied\";\n      }\n    }\n\n    return Promise.reject(error);\n  },\n);\n\n\nexport interface ApiError {\n  timestamp: string\n  status: number\n  error: string\n  message: string\n  path: string\n}\n\nexport function getErrorMessage(error: unknown): string {\n  if (axios.isAxiosError(error)) {\n    const apiError = error.response?.data as ApiError\n    if (apiError?.message) {\n      return apiError.message\n    }\n    return error.message || \"An unexpected error occurred\"\n  }\n  if (error instanceof Error) {\n    return error.message\n  }\n  return \"An unexpected error occurred\"\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,eAAe,6DAAmC;AAEjD,MAAM,cAAc,gJAAK,CAAC,MAAM,CAAC;IACtC,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAEA,0CAA0C;AAC1C,YAAY,YAAY,CAAC,OAAO,CAAC,GAAG,CAClC,CAAC;IACC;;IAMA,OAAO;AACT,GACA,CAAC,QAAU,QAAQ,MAAM,CAAC;AAG5B,0CAA0C;AAC1C,YAAY,YAAY,CAAC,QAAQ,CAAC,GAAG,CACnC,CAAC,WAAa,UACd,CAAC;IACC,MAAM,SAAS,MAAM,QAAQ,EAAE;IAC/B,MAAM,MAAM,MAAM,MAAM,EAAE,OAAO;IAEjC,gDAAgD;IAChD,MAAM,gBACJ,IAAI,QAAQ,CAAC,yBACb,IAAI,QAAQ,CAAC;IAEf,IAAI,WAAW,OAAO,CAAC,eAAe;QACpC,uEAAuE;QACvE;;IAKF,OAAO,IAAI,WAAW,KAAK;QACzB,qDAAqD;QACrD;;IAGF;IAEA,OAAO,QAAQ,MAAM,CAAC;AACxB;AAYK,SAAS,gBAAgB,KAAc;IAC5C,IAAI,gJAAK,CAAC,YAAY,CAAC,QAAQ;QAC7B,MAAM,WAAW,MAAM,QAAQ,EAAE;QACjC,IAAI,UAAU,SAAS;YACrB,OAAO,SAAS,OAAO;QACzB;QACA,OAAO,MAAM,OAAO,IAAI;IAC1B;IACA,IAAI,iBAAiB,OAAO;QAC1B,OAAO,MAAM,OAAO;IACtB;IACA,OAAO;AACT"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///Users/adrialorente/Downloads/web-v1.3/lib/api/auth-api.ts"],"sourcesContent":["import { axiosClient } from \"./axios-client\"\n\nexport interface LoginRequest {\n  username: string\n  password: string\n}\n\nexport interface RegisterRequest {\n  fullName: string\n  email: string\n  username: string\n  password: string\n}\n\nexport interface AuthResponse {\n  id: number\n  username: string\n  role: \"ADMIN\" | \"USER\"\n  token: string\n}\n\nexport const authApi = {\n  login: async (data: LoginRequest): Promise<AuthResponse> => {\n    const response = await axiosClient.post<AuthResponse>(\"/api/v1/auth/login\", data)\n    return response.data\n  },\n\n  register: async (data: RegisterRequest): Promise<void> => {\n    await axiosClient.post(\"/api/v1/auth/register\", data)\n  },\n}\n"],"names":[],"mappings":";;;;AAAA;;AAqBO,MAAM,UAAU;IACrB,OAAO,OAAO;QACZ,MAAM,WAAW,MAAM,4IAAW,CAAC,IAAI,CAAe,sBAAsB;QAC5E,OAAO,SAAS,IAAI;IACtB;IAEA,UAAU,OAAO;QACf,MAAM,4IAAW,CAAC,IAAI,CAAC,yBAAyB;IAClD;AACF"}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///Users/adrialorente/Downloads/web-v1.3/contexts/auth-context.tsx"],"sourcesContent":["\"use client\"\n\nimport { createContext, useContext, useState, useEffect, useCallback, type ReactNode } from \"react\"\nimport { authApi, type LoginRequest, type RegisterRequest, type AuthResponse } from \"@/lib/api/auth-api\"\nimport { useRouter } from \"next/navigation\"\n\nexport interface AuthUser {\n  id: number\n  username: string\n  role: \"ADMIN\" | \"USER\"\n}\n\ninterface AuthContextType {\n  user: AuthUser | null\n  token: string | null\n  isLoading: boolean\n  isAuthenticated: boolean\n  isAdmin: boolean\n  login: (data: LoginRequest) => Promise<AuthResponse>\n  register: (data: RegisterRequest) => Promise<void>\n  logout: () => void\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<AuthUser | null>(null)\n  const [token, setToken] = useState<string | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const router = useRouter()\n\n  // Load session from localStorage on mount\n  useEffect(() => {\n    const storedToken = localStorage.getItem(\"token\")\n    const storedUser = localStorage.getItem(\"user\")\n\n    if (storedToken && storedUser) {\n      try {\n        setToken(storedToken)\n        setUser(JSON.parse(storedUser))\n      } catch {\n        localStorage.removeItem(\"token\")\n        localStorage.removeItem(\"user\")\n      }\n    }\n    setIsLoading(false)\n  }, [])\n\n  const login = useCallback(async (data: LoginRequest): Promise<AuthResponse> => {\n    const response = await authApi.login(data)\n\n    // Store in state\n    setToken(response.token)\n    setUser({\n      id: response.id,\n      username: response.username,\n      role: response.role,\n    })\n\n    // Persist to localStorage\n    localStorage.setItem(\"token\", response.token)\n    localStorage.setItem(\n      \"user\",\n      JSON.stringify({\n        id: response.id,\n        username: response.username,\n        role: response.role,\n      }),\n    )\n\n    return response\n  }, [])\n\n  const register = useCallback(async (data: RegisterRequest): Promise<void> => {\n    await authApi.register(data)\n  }, [])\n\n  const logout = useCallback(() => {\n    setUser(null)\n    setToken(null)\n    localStorage.removeItem(\"token\")\n    localStorage.removeItem(\"user\")\n    router.push(\"/login\")\n  }, [router])\n\n  const value: AuthContextType = {\n    user,\n    token,\n    isLoading,\n    isAuthenticated: !!user && !!token,\n    isAdmin: user?.role === \"ADMIN\",\n    login,\n    register,\n    logout,\n  }\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext)\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\")\n  }\n  return context\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;AAJA;;;;;AAuBA,MAAM,4BAAc,IAAA,sNAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAkB;IAClD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAClD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,SAAS,IAAA,+IAAS;IAExB,0CAA0C;IAC1C,IAAA,kNAAS,EAAC;QACR,MAAM,cAAc,aAAa,OAAO,CAAC;QACzC,MAAM,aAAa,aAAa,OAAO,CAAC;QAExC,IAAI,eAAe,YAAY;YAC7B,IAAI;gBACF,SAAS;gBACT,QAAQ,KAAK,KAAK,CAAC;YACrB,EAAE,OAAM;gBACN,aAAa,UAAU,CAAC;gBACxB,aAAa,UAAU,CAAC;YAC1B;QACF;QACA,aAAa;IACf,GAAG,EAAE;IAEL,MAAM,QAAQ,IAAA,oNAAW,EAAC,OAAO;QAC/B,MAAM,WAAW,MAAM,oIAAO,CAAC,KAAK,CAAC;QAErC,iBAAiB;QACjB,SAAS,SAAS,KAAK;QACvB,QAAQ;YACN,IAAI,SAAS,EAAE;YACf,UAAU,SAAS,QAAQ;YAC3B,MAAM,SAAS,IAAI;QACrB;QAEA,0BAA0B;QAC1B,aAAa,OAAO,CAAC,SAAS,SAAS,KAAK;QAC5C,aAAa,OAAO,CAClB,QACA,KAAK,SAAS,CAAC;YACb,IAAI,SAAS,EAAE;YACf,UAAU,SAAS,QAAQ;YAC3B,MAAM,SAAS,IAAI;QACrB;QAGF,OAAO;IACT,GAAG,EAAE;IAEL,MAAM,WAAW,IAAA,oNAAW,EAAC,OAAO;QAClC,MAAM,oIAAO,CAAC,QAAQ,CAAC;IACzB,GAAG,EAAE;IAEL,MAAM,SAAS,IAAA,oNAAW,EAAC;QACzB,QAAQ;QACR,SAAS;QACT,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,OAAO,IAAI,CAAC;IACd,GAAG;QAAC;KAAO;IAEX,MAAM,QAAyB;QAC7B;QACA;QACA;QACA,iBAAiB,CAAC,CAAC,QAAQ,CAAC,CAAC;QAC7B,SAAS,MAAM,SAAS;QACxB;QACA;QACA;IACF;IAEA,qBAAO,8OAAC,YAAY,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AAC9C;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,mNAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}}]
}